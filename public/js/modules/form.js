/*! Tomcat360.com (c) 2015 
	Author: Renzhao
*/
define("modules/form",["validator","form-validator"],function(t,r,i){"use strict";var s=t("validator"),e=t("form-validator"),a=function(t,r){return this.version="0.1.4",this.form=t||"form",this.params={},this.rulers=[],"string"==typeof this.form&&(this.form=$(this.form).first()),this.form.size()?this._init(r):this};a.prototype={_init:function(t){var r=this;return this.inputlist=this.form.find("input:not([disabled]):not([type=hidden]):not([type='checkbox']):not([type='radio'])"),t=t||{},this.params.isBlurValidate=!1===t.isBlurValidate?!1:!0,this.rulers=t.rulers||[],this.params.isBlurValidate&&this.inputlist.blur(function(t){var i=$(this);r._validateInput(i)}),this.inputlist.focus(function(){r.closeAlert($(this))}),this.form.submit(function(){for(var t=0,i=r.inputlist.size();i>t;++t){var s=r.inputlist.eq(t);if(!r._validateInput(s))return!1}return!0}),r},_validateInput:function(t){for(var r=this,i=t.attr("name"),a=t.data("validator"),n=e[a]?[e[a]]:[],o=0,l=r.rulers.length;l>o;++o){var u=r.rulers[o];if(u.name===i){"function"==typeof u.validator&&n.push(u.validator);break}}for(var f=!0,o=0,l=n.length;l>o;++o){var h=n[o],d=h(t.val(),s,t);d.result||(r.alert(t,d),f=!1)}return f},_getAlert:function(t){var r=t.parents(".pure-control-group");return r.find(".xlabel")},submit:function(t){return this.form.submit(t),this},alert:function(t,r){this.closeAlert(t);var i=r.status?"success":"error",s=$("<div></div>");return s.addClass("xlabel").addClass(i).html(r.msg),t.parents(".pure-control-group").append(s),self},closeAlert:function(t){var r=this._getAlert(t);return r.size()&&r.remove(),self}},i.exports=a});